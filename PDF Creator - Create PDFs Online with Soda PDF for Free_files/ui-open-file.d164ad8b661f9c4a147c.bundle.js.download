webpackJsonp_name_([144],{BZIW:function(e,n,t){"use strict";t("jKMt"),t("o4bB");var o="ui-open-file-module",r="ui-open-file-factory",i=angular.module(o,["ngFileUpload","ui-helper-module","online-status-factory-module","ui-sitemenu-create-from-file-module"]);function c(e,n,t,o,r,i,c,a){var l=r.getDialogFactory(),s=r.getPdfFeatureFactory(),u={isProcessing:!1,executingTranslateString:"Opening... {{param1}}%, please wait...",supportedFormats:o.supportedFormats,refresh:function(){u.progressPercentage=0,u.isProcessing=!1,u.isCancelationRequired=!1,u.uploader=null}},f=function(e,n){u.uploader=i.upload(e,function(e,t,o,r){var i="";r&&r.file&&(i=r.file.name),void 0!==n&&"function"==typeof n&&n(e,i,i.fileExtension().name)},function(e,n,t,o){c.isOnline()?!e&&0===n||isUndefinedOrNull(u.uploader)||l.then(function(e){e.messageBox.show({text:"Could not load file",icon:"error",allowOverlayDialog:!0})}):l.then(function(e){e.messageBox.show({text:"Error loading your PDF file. Please check your network connection and try again.",icon:"error"})}),u.refresh()},function(e){u.progressPercentage=parseInt(100*e.loaded/e.total)})};return u.upload=function(e){if(e&&e.length){var n=e[0],o=n.name.fileExtension();if(!o.isValid)return void r.getDialogFactory().then(function(e){e.messageBox.show({text:t.instant("Unsupported file format"),icon:"error"})});if("pdf"!==o.name&&"wwf"!==o.name){var i=[{text:"ok",callback:function(){u.progressPercentage=0,u.isProcessing=!0,f(n,function(e,n,t){a.createPdf(e,n,t)})}},{text:"cancel",callback:function(){u.refresh()}}];s.then(function(e){e.isFeaturePermitted("Convert-Free.Common",!0)})&&i[0].callback()}else u.progressPercentage=0,u.isProcessing=!0,f(n,function(e,n,t){var o={name:n,action:"open"};u.openDocument(e,o).finally(function(){return u.refresh()})})}},u.cancel=function(){u.uploader&&(u.uploader.abort("test"),u.refresh())},u.openDocument=function(n,t){if(void 0!==n){u.isVisible=!1;var o={id:n};return void 0!==t&&(o.options=t),e.$state.transitionTo("document",o)}return u.isVisible=!1,e.$state.transitionTo("home")},e.$on("event-document-create-complete",function(){return u.refresh()}),e.$on("event-document-create-error",function(){return u.refresh()}),u}function a(e,n,t,o){var r={},i=n.getDialogFactory(),c=null,a=null;n.getPdfManagerFactory().then(function(e){c=e}),n.getPdfModelFactory().then(function(e){a=e});var l=function(e,n){r.isUploading=!1,r.isFileSelected=!1,n||i.then(function(n){n.messageBox.show({icon:"error",text:e})})};return r.createPdf=function(n,i,s){var u={FileEntries:[{FileType:s,FileName:i,FileGuid:n}],FromFileType:s,ToFileType:"pdf"};a.createPdfDocument(u).then(function(n){if(1!==n.result||3===n.status||12===n.status)l("Error occured");else{r.progressPercentage=0,r.isUploading=!1;var i=n.destFiles[0],s={id:i.FileGuid,name:i.FileName};c.addEmptyDocument(s.id,{name:s.name});var u=n.actionId,f=function(n,t){isUndefinedOrNull(t)&&(t={}),t.id=u,t.document=s,function(n,t){e.$broadcast(n,t)}(n,t)},d=!1,p=function(){d=!0,a.cancelCreateConvertOCRDocumentProcessing(u,2)};f("event-document-create-in-process",{progress:0,cancel:p});var m=t(function(){!0!==d&&c.isExists(s.id)?a.checkStatus(u).then(function(n){!0!==d&&(1===n.result&&3!==n.status&&12!==n.status?14!==n.status?(f("event-document-create-in-process",{progress:n.progress,cancel:p}),2===n.status&&(f("event-document-create-complete"),t.cancel(m)&&c.closeDocument(s.id,!0).then(function(){e.$state.transitionTo("document",{id:s.id,options:{name:n.destFiles[0].FileName,action:"open"}})}))):f("event-document-create-complete"):t.cancel(m)&&(f("event-document-create-error")||l("Error occured")))},function(e){t.cancel(m)}):t.cancel(m)},5e3);o(function(){t.cancel(m)&&f("event-document-create-error")},3e5)}},function(e){r.progressPercentage=0,0!==e.status&&l("Error occured")})},r}i.controller("ui-open-file-controller",["$scope",r,"GLOBAL",function(e,n,t){e.factory=n,e.isOpera=t.isOpera,n.refresh(),e.upload=function(e,t){if(e&&e.length){var o=void 0;"choose"==t?o="choose-file":"drop"==t&&(o="drag-and-drop"),o&&jTracking&&jTracking.trackEvent&&jTracking.trackEvent({customEvent:"document",category:"document",action:"uploaded",label:o}),n.upload(e,"drop")}},e.cancel=function(){n.cancel()},e.$watch("file",function(){e.upload(e.file?[e.file]:null,"drop")}),e.isOpenAnotherFile=!1,e.openAnotherFileMenuClick=function(){e.isOpenAnotherFile=!e.isOpenAnotherFile},e.isSaveFile=!1,e.saveFileMenuClick=function(){e.isSaveFile=!e.isSaveFile}}]),i.factory(r,c),i.factory("ui-create-file-factory",a),c.$inject=["$rootScope","$injector","$translate","appSettings","ui-helper-factory","storage-document-uploader-service","online-status-factory","ui-create-file-factory"],a.$inject=["$rootScope","ui-helper-factory","$interval","$timeout"],mainApp.controller("ui-open-file-controller",getConstructor(o,"ui-open-file-controller","controller")),mainApp.factory(r,getConstructor(o,r,"factory")),mainApp.factory("ui-create-file-factory",getConstructor(o,"ui-create-file-factory","factory"))}});